---
interface Props {
  id: string;
  zoom?: number;
  popup?: string;
  class?: string;
}

const {
  id,
  zoom = 12,
  popup,
  class: className = "w-full h-full",
} = Astro.props;

const center = [43.391094, -5.185168];
---

<div id={id} class={className}></div>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>
<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script is:inline define:vars={{ id, center, zoom, popup }}>
  document.addEventListener("DOMContentLoaded", function () {
    var mapEl = document.getElementById(id);
    if (!mapEl) return;

    var map = L.map(mapEl, {
      center: center,
      zoom: zoom,
      scrollWheelZoom: false,
      attributionControl: false,
    });

    L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      {
        maxZoom: 19,
        attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>',
      }
    ).addTo(map);

    var markerIcon = L.divIcon({
      html: '<div style="width:20px;height:20px;background:#8cb950;border:3px solid white;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.3);"></div>',
      iconSize: [20, 20],
      iconAnchor: [10, 10],
      className: "",
    });

    var marker = L.marker(center, { icon: markerIcon }).addTo(map);
    if (popup) {
      marker.bindPopup(popup);
    }

    map.on("click", function () {
      map.scrollWheelZoom.enable();
    });
  });
</script>
